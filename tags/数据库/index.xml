<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>数据库 on </title>
    <link>http://wyb0.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/</link>
    <description>Recent content in 数据库 on </description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>&amp;copy; 2016-2017 Reber. All Rights Reserved.</copyright>
    <lastBuildDate>Sun, 07 Aug 2016 23:38:58 +0800</lastBuildDate>
    <atom:link href="http://wyb0.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Windows下第三方服务提权</title>
      <link>http://wyb0.com/posts/Windows%E4%B8%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E6%9C%8D%E5%8A%A1%E6%8F%90%E6%9D%83/</link>
      <pubDate>Sun, 07 Aug 2016 23:38:58 +0800</pubDate>
      
      <guid>http://wyb0.com/posts/Windows%E4%B8%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E6%9C%8D%E5%8A%A1%E6%8F%90%E6%9D%83/</guid>
      <description>

&lt;p&gt;&lt;center&gt;&lt;h2&gt;MSSQL和MySQL提权&lt;/h2&gt;&lt;/center&gt;&lt;/p&gt;

&lt;h2 id=&#34;mssql提权:138d8bfd13dc206a8cdf346aa048c60c&#34;&gt;MSSQL提权&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;MSSQL运行在system权限时才可以通过xp_cmdshell组件执行系统命令提权&lt;br /&gt;
提权条件：数据库账号是DBA权限&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&#34;关于xp-cmdshell:138d8bfd13dc206a8cdf346aa048c60c&#34;&gt;关于xp_cmdshell&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;得到数据库连接信息，连接数据库后执行EXEC xp_cmdshell &amp;lsquo;net user&amp;rsquo;;&lt;/li&gt;
&lt;li&gt;有sql注入时也可以直接在url上使用xp_cmdshell，因为mssql可以多语句执行，例如?id=1;EXEC xp_cmdshell &amp;lsquo;net user&amp;rsquo;;--&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;连接数据库:138d8bfd13dc206a8cdf346aa048c60c&#34;&gt;连接数据库&lt;/h4&gt;

&lt;blockquote&gt;
&lt;p&gt;
&lt;div class=&#34;pure-u-1&#34;&gt;
  &lt;img class=&#34;pure-img&#34; src=&#34;http://wyb0.com/img/post/privilge_escalation_win_find_sql_conn_msg.png&#34; alt=&#34;Windows下第三方服务提权-找数据库连接信息&#34;&gt;
&lt;/div&gt;

&lt;br /&gt;&lt;br /&gt;

&lt;div class=&#34;pure-u-1&#34;&gt;
  &lt;img class=&#34;pure-img&#34; src=&#34;http://wyb0.com/img/post/privilge_escalation_win_conn_mssql.png&#34; alt=&#34;Windows下第三方服务提权-连接mssql数据库&#34;&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&#34;执行系统命令:138d8bfd13dc206a8cdf346aa048c60c&#34;&gt;执行系统命令&lt;/h4&gt;

&lt;blockquote&gt;
&lt;p&gt;
&lt;div class=&#34;pure-u-1&#34;&gt;
  &lt;img class=&#34;pure-img&#34; src=&#34;http://wyb0.com/img/post/privilge_escalation_win_try_exec_sys_command.png&#34; alt=&#34;Windows下第三方服务提权-尝试用xp_cmdshell执行命令&#34;&gt;
&lt;/div&gt;

&lt;br /&gt;&lt;br /&gt;

&lt;div class=&#34;pure-u-1&#34;&gt;
  &lt;img class=&#34;pure-img&#34; src=&#34;http://wyb0.com/img/post/privilge_escalation_win_open_cmd_shell.png&#34; alt=&#34;Windows下第三方服务提权-开启xp_cmdshell组件&#34;&gt;
&lt;/div&gt;

&lt;br /&gt;&lt;br /&gt;

&lt;div class=&#34;pure-u-1&#34;&gt;
  &lt;img class=&#34;pure-img&#34; src=&#34;http://wyb0.com/img/post/privilge_escalation_win_exec_sys_command_success.png&#34; alt=&#34;Windows下第三方服务提权-使用xp_cmdshell成功执行命令&#34;&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&#34;添加用户:138d8bfd13dc206a8cdf346aa048c60c&#34;&gt;添加用户&lt;/h4&gt;

&lt;blockquote&gt;
&lt;p&gt;
&lt;div class=&#34;pure-u-1&#34;&gt;
  &lt;img class=&#34;pure-img&#34; src=&#34;http://wyb0.com/img/post/privilge_escalation_win_add_user.png&#34; alt=&#34;Windows下第三方服务提权-添加用户&#34;&gt;
&lt;/div&gt;

&lt;br /&gt;&lt;br /&gt;

&lt;div class=&#34;pure-u-1&#34;&gt;
  &lt;img class=&#34;pure-img&#34; src=&#34;http://wyb0.com/img/post/privilge_escalation_win_view_user.png&#34; alt=&#34;Windows下第三方服务提权-查看添加的用户&#34;&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&#34;远程连接:138d8bfd13dc206a8cdf346aa048c60c&#34;&gt;远程连接&lt;/h4&gt;

&lt;blockquote&gt;
&lt;p&gt;
&lt;div class=&#34;pure-u-1&#34;&gt;
  &lt;img class=&#34;pure-img&#34; src=&#34;http://wyb0.com/img/post/privilge_escalation_win_remote_conn.png&#34; alt=&#34;Windows下第三方服务提权-远程连接&#34;&gt;
&lt;/div&gt;

&lt;br /&gt;&lt;br /&gt;

&lt;div class=&#34;pure-u-1&#34;&gt;
  &lt;img class=&#34;pure-img&#34; src=&#34;http://wyb0.com/img/post/privilge_escalation_win_input_u_p.png&#34; alt=&#34;Windows下第三方服务提权-输入用户名和密码&#34;&gt;
&lt;/div&gt;

&lt;br /&gt;&lt;br /&gt;

&lt;div class=&#34;pure-u-1&#34;&gt;
  &lt;img class=&#34;pure-img&#34; src=&#34;http://wyb0.com/img/post/privilge_escalation_win_remote_connection_view_ip.png&#34; alt=&#34;Windows下第三方服务提权-输入用户名和密码&#34;&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h2 id=&#34;mysql提权:138d8bfd13dc206a8cdf346aa048c60c&#34;&gt;MySQL提权&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;环境：web应用服务器权限较低&lt;br /&gt;
提权条件：MySQL是system权限&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&#34;关于udf:138d8bfd13dc206a8cdf346aa048c60c&#34;&gt;关于UDF&lt;/h4&gt;

&lt;blockquote&gt;
&lt;p&gt;MySQL提权可以用UDF和Mof。UDF就是User defined Function，即用户定义函数，可以通过创建存储方法来定义函数，从而调用系统命令。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&#34;udf提权过程:138d8bfd13dc206a8cdf346aa048c60c&#34;&gt;UDF提权过程&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;导入udf.dll到服务器指定目录&lt;br /&gt;

&lt;ul&gt;
&lt;li&gt;MySQL版本小于5.1的udf.dll要导入到c:\windows\目录下&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;MySQL版本大于等于5.1的udf.dll要导入到plugin_dir目录，plugin_dir在MySQL安装目录下的lib/plugin目录下(MySQL安装目录可以用select @@basedir得到)，默认不存在这个目录，我们要自己创建&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;使用SQL语句创建功能函数&lt;br /&gt;
CREATE FUNCTION shell RETURNS STRING SONAME &amp;lsquo;udf.dll&amp;rsquo;;&lt;/li&gt;
&lt;li&gt;执行MySQL语句调用新创建的函数&lt;br /&gt;
select shell(&amp;lsquo;cmd&amp;rsquo;,&amp;lsquo;whoami&amp;rsquo;);&lt;/li&gt;
&lt;li&gt;删除创建的函数&lt;br /&gt;
drop function shell;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;查看基本信息:138d8bfd13dc206a8cdf346aa048c60c&#34;&gt;查看基本信息&lt;/h4&gt;

&lt;blockquote&gt;
&lt;p&gt;
&lt;div class=&#34;pure-u-1&#34;&gt;
  &lt;img class=&#34;pure-img&#34; src=&#34;http://wyb0.com/img/post/privilge_escalation_win_view_base_msg.png&#34; alt=&#34;Windows下第三方服务提权-查看基本信息&#34;&gt;
&lt;/div&gt;

&lt;br /&gt;&lt;br /&gt;

&lt;div class=&#34;pure-u-1&#34;&gt;
  &lt;img class=&#34;pure-img&#34; src=&#34;http://wyb0.com/img/post/privilge_escalation_win_view_current_user.png&#34; alt=&#34;Windows下第三方服务提权-查看当前用户&#34;&gt;
&lt;/div&gt;

&lt;br /&gt;&lt;br /&gt;

&lt;div class=&#34;pure-u-1&#34;&gt;
  &lt;img class=&#34;pure-img&#34; src=&#34;http://wyb0.com/img/post/privilge_escalation_win_view_current_user_permissions.png&#34; alt=&#34;Windows下第三方服务提权-查看当前用户权限&#34;&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&#34;上传udf提权:138d8bfd13dc206a8cdf346aa048c60c&#34;&gt;上传udf提权&lt;/h4&gt;

&lt;blockquote&gt;
&lt;p&gt;
&lt;div class=&#34;pure-u-1&#34;&gt;
  &lt;img class=&#34;pure-img&#34; src=&#34;http://wyb0.com/img/post/privilge_escalation_win_upload_udf.png&#34; alt=&#34;Windows下第三方服务提权-上传udf&#34;&gt;
&lt;/div&gt;

&lt;br /&gt;&lt;br /&gt;

&lt;div class=&#34;pure-u-1&#34;&gt;
  &lt;img class=&#34;pure-img&#34; src=&#34;http://wyb0.com/img/post/privilge_escalation_win_conn_mysql.png&#34; alt=&#34;Windows下第三方服务提权-连接数据库&#34;&gt;
&lt;/div&gt;

&lt;br /&gt;&lt;br /&gt;

&lt;div class=&#34;pure-u-1&#34;&gt;
  &lt;img class=&#34;pure-img&#34; src=&#34;http://wyb0.com/img/post/privilge_escalation_win_export_udf.png&#34; alt=&#34;Windows下第三方服务提权-导出udf.dll并生成函数&#34;&gt;
&lt;/div&gt;

&lt;br /&gt;&lt;br /&gt;

&lt;div class=&#34;pure-u-1&#34;&gt;
  &lt;img class=&#34;pure-img&#34; src=&#34;http://wyb0.com/img/post/privilge_escalation_win_exec_whoami.png&#34; alt=&#34;Windows下第三方服务提权-提权成功执行whoami&#34;&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&#34;添加用户-1:138d8bfd13dc206a8cdf346aa048c60c&#34;&gt;添加用户&lt;/h4&gt;

&lt;blockquote&gt;
&lt;p&gt;
&lt;div class=&#34;pure-u-1&#34;&gt;
  &lt;img class=&#34;pure-img&#34; src=&#34;http://wyb0.com/img/post/privilge_escalation_win_shell_add_user.png&#34; alt=&#34;Windows下第三方服务提权-通过shell函数添加用户&#34;&gt;
&lt;/div&gt;

&lt;br /&gt;&lt;br /&gt;

&lt;div class=&#34;pure-u-1&#34;&gt;
  &lt;img class=&#34;pure-img&#34; src=&#34;http://wyb0.com/img/post/privilge_escalation_win_shell_add_user_to_administrators.png&#34; alt=&#34;Windows下第三方服务提权-通过shell函数添加用户到管理员组&#34;&gt;
&lt;/div&gt;

&lt;br /&gt;&lt;br /&gt;

&lt;div class=&#34;pure-u-1&#34;&gt;
  &lt;img class=&#34;pure-img&#34; src=&#34;http://wyb0.com/img/post/privilge_escalation_win_shell_active_user.png&#34; alt=&#34;Windows下第三方服务提权-通过shell函数激活用户&#34;&gt;
&lt;/div&gt;

&lt;br /&gt;&lt;br /&gt;

&lt;div class=&#34;pure-u-1&#34;&gt;
  &lt;img class=&#34;pure-img&#34; src=&#34;http://wyb0.com/img/post/privilge_escalation_win_shell_view_user.png&#34; alt=&#34;Windows下第三方服务提权-通过shell函数查看用户&#34;&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&#34;远程连接-1:138d8bfd13dc206a8cdf346aa048c60c&#34;&gt;远程连接&lt;/h4&gt;

&lt;blockquote&gt;
&lt;p&gt;
&lt;div class=&#34;pure-u-1&#34;&gt;
  &lt;img class=&#34;pure-img&#34; src=&#34;http://wyb0.com/img/post/privilge_escalation_win_shell_remote_connection.png&#34; alt=&#34;Windows下第三方服务提权-远程3389连接&#34;&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
  </channel>
</rss>